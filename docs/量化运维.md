# 量化运维

### nano服务器运维

交易日志：/home/zszq/orders/0050092888/ta*

配置：/home/zszq/orders/setting/0050092888.ini

交易订单：/data/orders/algo_ALP/*.csv save文件是已执行的

执行交易：/home/zszq/orders/trade_alp.py

## cron.py

## 📅 定时任务明细

### 1. `07:51:06`

- 路径：`/home/zszq/works/ctradeN/bin`

- 脚本：`daily_prod.py`

- 作用：日内生产数据初始化。

---

### 2. `08:00:06`

- 路径：`/home/zszq/works/ctradeN/bin`

- 操作：拷贝 `config.xml.algotick.20220418.prdN4N5.3m.L0.ONLINE` → `config.xml`

- 脚本：`data_daily_begin.py`(每天更新config.xml, 交易日设为online模式，非交易日设置成backtest模式，不用运行)

- 启动：`./cTrade`（绑核 22,24）

- 作用：启动 **4N5 算法交易进程**。

---

### 3. `08:06:06`

- 路径：`/home/zszq/works/ctradeN/python`

- 脚本：`vol_prd.py`（绑核 26）

- 日志：`../bin/log/vol_prd_YYYYMMDD`

- 作用：运行日内成交量预测模块。

---

### 4. `09:27:06`

- 路径：`/home/zszq/works/ctradeN/bin`

- 操作：拷贝 `config.xml.rawdata.rt` → `config.xml`

- 脚本：`data_daily_begin_raw.py online`

- 启动：`./cTrade`（绑核 28）

- 日志：`./log/raw_rt_YYYYMMDD`

- 作用：启动 **实盘实时行情采集**。

---

### 5. 收盘后采集账户信息

- 路径：`/home/zszq/works/ctradeN/bin`

- 启动：`./cTrade config.xml.trader.atp.output`（绑核 35-36）

- 日志：`./log/acct_info_YYYYMMDD`

- 时间点：
  
  - `15:03:16`
  
  - `15:15:06`
  
  - `16:30:08`

- 作用：三次采集账户信息（保证完整性）。

---

## 🔹 一次性启动（非定时）

脚本运行时，还会执行一次：

- 路径：`/home/zszq/works/ctradeN/python`

- 杀掉已有 `data_morning.py` 进程

- 启动：`data_morning.py`（绑核 20，日志 `log_morning.log`）

- 作用：晨间数据准备（开盘前数据更新）。

---

## ✅ 总结一句话

**这个文件就是交易日自动化调度器**：

- 07:51 → 初始化日生产数据

- 08:00 → 启动算法交易（4N5）

- 08:06 → 跑成交量预测

- 09:27 → 启动实时行情采集

- 收盘后三次 → 导出账户信息

- 额外 → 每次启动时先跑 `data_morning.py`，做晨间准备

## 晨间数据处理

### data_morning.py

路径：`/home/zszq/works/ctradeN/python/data_morning.py`

每天循环检测当天的压缩包数据（`/data/efh/tar/日期.tar.gz`），在不同时间段自动执行：

1. **解压数据包**
   
   - 将 `日期.tar.gz` 解压到 `/data/efh/tar/日期/`。

2. **拷贝元数据**（在 08:30 之后）
   
   - `all/tkr.txt` → `/data/efh/Meta/`
   
   - `all/universe_all.txt` → `/data/efh/Meta/`
   
   - 如果是工作日：
     
     - `dly/universe.txt.日期` → `/data/efh/Univ/universe.txt.日期`

3. **拷贝行情和因子数据**（07:00–07:30 或 09:20 之后）
   
   - `daily/*` → `/data/efh/daily/`
   
   - `dailyfactor/*` → `/data/efh/dailyfactor/`

4. **运行更新脚本**
   
   - 更新日行情：  
     `/opt/anaconda3/bin/python /home/zszq/works/ctradeN/python/daily_bar.py inc`
   
   - 更新因子：  
     `/opt/anaconda3/bin/python /home/zszq/works/ctradeN/python/daily_factor.py inc`
   
   - 计算 Barra 风险模型：  
     `/opt/anaconda3/bin/python /data/efh/barra/CNE6_20211006/model_cne6_linux_20220430.py`

5. **清理和等待**
   
   - 不同时段处理完会删除当天的 `.tar.gz`，打印 `first/second/third finished...`，并等待到下一时段。
