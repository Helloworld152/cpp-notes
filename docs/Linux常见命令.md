# Linux常见命令

## vim

```bash
/ 正向搜索 
? 反向搜索
set nu 显示行号
G 最后一行
```

## scp

```bash
# 从本地复制文件到远程
scp file.txt user@192.168.1.10:/home/user/

# 从远程复制文件到本地
scp user@192.168.1.10:/home/user/file.txt /local/path/

# 复制整个目录（-r 递归）
scp -r /local/dir user@192.168.1.10:/remote/path/

# 从远程服务器下载整个目录
scp -r user@192.168.1.10:/remote/dir /local/path/

# 指定端口号（-P 大写）
scp -P 2222 file.txt user@192.168.1.10:/home/user/
```

## stat

```bash
# 查看文件详细信息（权限、大小、时间等）
stat file.txt
```

## find

```bash
find . -name "filename" # 在当前目录及子目录查找文件
```

好的，根据您在实际诊断中用到的 `top` 命令，我来详细解释其中每一项数据的含义，并关联我们之前讨论的底层 $\text{Linux}$ 核心概念。

`top` 命令主要分为三个主要区域：**系统总览区**、**$\text{CPU}$ 状态区**、**内存区**和**进程列表区**。

---

## top

```bash
top - 14:25:54 up 15 days, 20:06,  3 users,  load average: 6.44, 6.34, 6.12
任务: 1426 total,   1 running, 1411 sleeping,   0 stopped,  14 zombie
%Cpu(s):  3.0 us,  1.2 sy,  0.0 ni, 95.3 id,  0.4 wa,  0.0 hi,  0.1 si,  0.0 st
MiB Mem : 515219.6 total,   2138.3 free, 136542.1 used, 376539.2 buff/cache
MiB Swap:   8192.0 total,   8166.5 free,     25.5 used. 375292.7 avail Mem 

 进程号 USER      PR  NI    VIRT    RES    SHR    %CPU  %MEM     TIME+ COMMAND                                                      
 119194 rying     20   0   50.7g  39.7g  10020 S 229.3   7.9 430:54.35 market_data_ser                                              
4183045 rying     20   0   19.0g  10.4g   8196 S 126.6   2.1 388:35.07 hfd_tick                                                     
 439514 redis     20   0  149.4g  72.7g   2068 D  63.5  14.5   4:31.06 redis-server                                                 
 306522 redis     20   0  149.4g  73.8g   3416 S   9.2  14.7 460:42.79 redis-server                                                 
4154268 rying     20   0   80.3g 355948  63852 S   5.9   0.1  15:15.14 node                                                         
 776623 rying     20   0  626540 452980   4380 S   3.9   0.1 462:53.31 rg                                                           
 120532 rying     20   0 1328408  73152  48772 S   1.6   0.0   3:42.95 open-trade-ctps                                              
 336377 rying     20   0   78.6g 285792  63232 S   1.0   0.1   3:10.76 node                                                         
 453917 rying     20   0   18076   5676   3460 R   1.0   0.0   0:00.14 top                                                          
2550628 root      20   0 8551748 108008  58980 S   0.7   0.0 347:57.96 dockerd                                                      
2593531 root      20   0  156284  18076  10260 S   0.7   0.0  70:07.63 redis-server                                                 
2594217 1010      20   0  667548  32188  19224 S   0.7   0.0 196:36.70 winedevice.exe                                               
    134 root      20   0       0      0      0 S   0.3   0.0   1:05.02 ksoftirqd/20                                                 
   1884 root      20   0   82296   4228   3408 S   0.3   0.0  21:44.45 irqbalance                                                   
  15428 root      20   0 6759188  62636  36376 S   0.3   0.0 189:56.34 containerd                                                   
 120429 rying     20   0 1181420  81728  47320 S   0.3   0.0   0:57.48 open-trade-mdse                                              
 131157 rying     20   0 1004812  66696  41712 S   0.3   0.0   0:13.22 node                                                         
 177641 root      20   0  188300 100644  24460 S   0.3   0.0  52:43.35 jupyterhub                                                   
 438096 root      20   0       0      0      0 I   0.3   0.0   0:00.02 kworker/10:3-events                                          
 438123 root      20   0       0      0      0 I   0.3   0.0   0:00.03 kworker/61:0-mm_percpu_wq                                    
 446778 root      20   0       0      0      0 I   0.3   0.0   0:00.01 kworker/45:0-mm_percpu_wq                                    
2593154 root      20   0 1238352  15120  11044 S   0.3   0.0   8:17.20 containerd-shim                                              
2593912 1010      20   0   16164  14580   1776 S   0.3   0.0  14:18.77 wineserver                                                   
2622992 root      20   0 1238608  14888  11048 S   0.3   0.0   8:26.30 containerd-shim                                              
      1 root      20   0  171792  12972   8020 S   0.0   0.0  46:12.45 systemd                                                      
      2 root      20   0       0      0      0 S   0.0   0.0   0:26.63 kthreadd                                                     
      3 root       0 -20       0      0      0 I   0.0   0.0   0:00.00 rcu_gp                                                       
      4 root       0 -20       0      0      0 I   0.0   0.0   0:00.04 rcu_par_gp                                                   
      6 root       0 -20       0      0      0 I   0.0   0.0   0:00.00 kworker/0:0H-kblockd                                         
      9 root       0 -20       0      0      0 I   0.0   0.0   0:00.00 mm_percpu_wq                                                 
     10 root      20   0       0      0      0 S   0.0   0.0   1:18.68 ksoftirqd/0                                                  
     11 root      20   0       0      0      0 I   0.0   0.0  36:25.77 rcu_sched                                                    
     12 root      rt   0       0      0      0 S   0.0   0.0   0:03.19 migration/0                                                  
     13 root     -51   0       0      0      0 S   0.0   0.0   0:00.00 idle_inject/0                                                
     15 root      20   0       0      0      0 S   0.0   0.0   0:00.00 cpuhp/0                                                      
     16 root      20   0       0      0      0 S   0.0   0.0   0:00.00 cpuhp/1                                                      
     17 root     -51   0       0      0      0 S   0.0   0.0   0:00.00 idle_inject/1                                                
     18 root      rt   0       0      0      0 S   0.0   0.0   0:06.28 migration/1                                                  
     19 root      20   0       0      0      0 S   0.0   0.0   0:14.23 ksoftirqd/1                                                  
     21 root       0 -20       0      0      0 I   0.0   0.0   0:00.00 kworker/1:0H                                                 
     23 root      20   0       0      0      0 S   0.0   0.0   0:00.00 cpuhp/2                                                      
     24 root     -51   0       0      0      0 S   0.0   0.0   0:00.00 idle_inject/2                                                
     25 root      rt   0       0      0      0 S   0.0   0.0   0:06.12 migration/2                                                  
     26 root      20   0       0      0      0 S   0.0   0.0   0:33.57 ksoftirqd/2                                                  
     28 root       0 -20       0      0      0 I   0.0   0.0   0:00.00 kworker/2:0H-events_highpri                                  
     29 root      20   0       0      0      0 S   0.0   0.0   0:00.00 cpuhp/3                                                      
```

### 1. 系统总览区（第一行）

| **字段**               | **含义**                            | **底层关联**                                                   |
| -------------------- | --------------------------------- | ---------------------------------------------------------- |
| **`top - HH:MM:SS`** | 当前系统时间。                           | -                                                          |
| **`up ... days`**    | 系统持续运行的时间。                        | -                                                          |
| **`users`**          | 当前登录到系统的用户数。                      | -                                                          |
| **`load average`**   | **负载平均值**（$1$ 分钟、$5$ 分钟、$15$ 分钟）。 | **进程调度**：就绪（等待 $\text{CPU}$）和不可中断睡眠（等待 $\text{I/O}$）的进程总数。 |

### 2. 任务/进程区（第二行）

| **字段**         | **含义**                                | **底层关联**                                                                               |
| -------------- | ------------------------------------- | -------------------------------------------------------------------------------------- |
| **`total`**    | 进程总数。                                 | -                                                                                      |
| **`running`**  | 处于运行或就绪状态的进程数。                        | **进程调度**：正在被 $\text{CPU}$ 执行或等待 $\text{CPU}$ 调度的任务数。                                   |
| **`sleeping`** | 处于可中断睡眠状态的进程数 ($\text{S}$ 状态)。        | 进程在等待某些资源（如输入、定时器），可被信号唤醒。                                                             |
| **`stopped`**  | 处于停止状态的进程数（被 $\text{SIGSTOP}$ 等信号停止）。 | -                                                                                      |
| **`zombie`**   | 处于僵尸状态的进程数。                           | **进程状态**：子进程已结束但父进程尚未调用 $\text{wait()}$ 来回收其 $\text{PCB}$ ($\text{task\_struct}$) 的进程。 |

### 3. $\text{CPU}$ 状态区（第三行）

这是最关键的性能指标，显示 $\text{CPU}$ 时间的分配百分比（$\text{CPU}$ 总时间 $= 100\%$）。

| **字段**                                           | **含义**                                                   | **底层关联**                                 |
| ------------------------------------------------ | -------------------------------------------------------- | ---------------------------------------- |
| **`us`** ($\text{User}$ $\text{Space}$)          | 用户空间**程序**执行所占用的时间。                                      | 应用程序代码执行的开销。                             |
| **`sy`** ($\text{System}$ $\text{Space}$)        | 内核空间执行所占用的时间。                                            | 进程执行**系统调用**、$\text{IPC}$ 或内核管理任务的开销。    |
| **`ni`** ($\text{Nice}$)                         | 具有非默认优先级的用户进程所占用的时间。                                     | **进程调度**：反映通过 $\text{nice}$ 值调整优先级的任务开销。 |
| **`id`** ($\text{Idle}$)                         | $\text{CPU}$ 处于**空闲**状态的时间。                              | $\text{CPU}$ 找不到任务可运行。                   |
| **`wa`** ($\text{I/O}$ $\text{Wait}$)            | $\text{CPU}$ **等待磁盘 $\text{I/O}$ 完成**的时间。                | **$\text{I/O}$ 瓶颈**：任务阻塞在磁盘读写上。          |
| **`hi`** ($\text{Hardware}$ $\text{Interrupts}$) | 处理硬件中断所占用的时间。                                            | 硬件设备发送信号给 $\text{CPU}$ 的开销。              |
| **`si`** ($\text{Software}$ $\text{Interrupts}$) | 处理软中断所占用的时间。                                             | 主要是网络数据包处理、内核定时器等。                       |
| **`st`** ($\text{Steal}$ $\text{Time}$)          | 虚拟机管理程序（$\text{Hypervisor}$）为其他虚拟机“偷走”的 $\text{CPU}$ 时间。 | 仅在虚拟化环境中有效。                              |

### 4. 内存区（第四、五行）

| **字段**           | **含义**                                                   | **底层关联**                                                           |
| ---------------- | -------------------------------------------------------- | ------------------------------------------------------------------ |
| **`total`**      | 物理内存总大小。                                                 | -                                                                  |
| **`free`**       | 尚未被任何程序使用的物理内存。                                          | -                                                                  |
| **`used`**       | 正在被应用程序、内核及 $\text{cache}$ 使用的物理内存。                      | -                                                                  |
| **`buff/cache`** | **内核缓冲区 ($\text{buffer}$) 和页缓存 ($\text{cache}$)** 占用的内存。 | **$\text{VFS}$**：$\text{Linux}$ 用这部分内存加速文件 $\text{I/O}$，是**可回收的**。 |
| **`Swap`**       | 交换空间的总量、空闲量和已使用量。                                        | **虚拟内存**：反映内存是否因不足而发生**换页**。                                       |

### 5. 进程列表区（核心列）

| **字段**                                             | **含义**                                                                                                                                                                                                       | **底层关联**                                             |
| -------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ---------------------------------------------------- |
| **$\text{PID}$**                                   | 进程 $\text{ID}$。                                                                                                                                                                                              | -                                                    |
| **$\text{USER}$**                                  | 进程所有者的用户名。                                                                                                                                                                                                   | -                                                    |
| **$\text{PR}$** ($\text{Priority}$)                | 进程的优先级。                                                                                                                                                                                                      | **进程调度**：内核调度器使用的实际优先级。                              |
| **$\text{NI}$** ($\text{Nice}$)                    | 进程的 $\text{Nice}$ 值（$-20$ 到 $19$）。                                                                                                                                                                           | **进程调度**：用户可调整的优先级。$\text{NI}$ 值越低（越负），优先级越高。        |
| **$\text{VIRT}$**                                  | 进程占用的**虚拟内存**总量。                                                                                                                                                                                             | **虚拟内存**：进程可访问的总地址空间，包括共享内存和 $\text{Swap}$。          |
| **$\text{RES}$** ($\text{Resident}$ $\text{Size}$) | 进程实际占用的**物理内存**总量。                                                                                                                                                                                           | **虚拟内存**：真实驻留在 $\text{RAM}$ 中的内存大小，是衡量内存占用的关键指标。     |
| **$\text{SHR}$** ($\text{Shared}$ $\text{Size}$)   | 进程与其他进程共享的内存。                                                                                                                                                                                                | **共享内存**或共享库的内存。                                     |
| **$\text{S}$** ($\text{Status}$)                   | 进程状态：**$\text{S}$** ($\text{Sleeping}$), **$\text{R}$** ($\text{Running}$), **$\text{D}$** ($\text{Disk}$ $\text{Sleep}$ / **不可中断睡眠**), **$\text{Z}$** ($\text{Zombie}$), **$\text{T}$** ($\text{Stopped}$)。 | **进程状态**：判断进程是在等待 $\text{CPU}$ 还是在等待 $\text{I/O}$/锁。 |
| **$\text{\%CPU}$**                                 | 进程在采样间隔内占用的 $\text{CPU}$ 时间百分比。                                                                                                                                                                              | **$\text{CPU}$ 调度**：衡量单个进程的 $\text{CPU}$ 消耗。         |
| **$\text{\%MEM}$**                                 | 进程占用的物理内存 ($\text{RES}$) 占总物理内存的百分比。                                                                                                                                                                         | -                                                    |
| **$\text{TIME+}$**                                 | 进程启动以来累计占用的 $\text{CPU}$ 时间。                                                                                                                                                                                 | -                                                    |
| **$\text{COMMAND}$**                               | 进程启动的命令行名称。                                                                                                                                                                                                  | -                                                    |

## ss

`ss`（socket statistics）是 Linux 下查看网络端口和连接的现代工具，用来完全替代 `netstat`。

```bash
# 查看所有监听端口（TCP/UDP），含进程信息
ss -tulnp
# -t TCP, -u UDP, -l LISTEN, -n 不解析域名, -p 显示进程

# 查看所有已建立的 TCP 连接
ss -tn state established
# 用于确认服务是否与外部成功通信

# 查看某个端口是否被占用
ss -tulnp | grep <端口号>
# 快速定位占用端口的进程

# 查看某个进程的所有网络连接
ss -tnp | grep <PID>
# 判断该进程是否监听端口或对外建立连接

# 查看 TCP 异常状态（排障常用）
ss -tan | grep CLOSE-WAIT   # 被动关闭方未正确 close，可能程序有 bug
ss -tan | grep TIME-WAIT    # 主动关闭方较多，连接频繁但一般可接受
```
